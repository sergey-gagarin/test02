<? include("header.php");     function adressen_cmp($adresa, $adresb)     {        if ($adresa[0] == $adresb[0]) return 0;        if ($adresa[0] < $adresb[0]) return -1;        if ($adresa[0] > $adresb[0]) return 1;    }        function schrijfadressen($adressen)     {        $fp = fopen("adressen", "w");        for ($i = 0; $i < sizeof($adressen); $i++) {            $line = "";            for ($j = 0; $j < sizeof($adressen[$i]); $j++) {                if ($j != 0)                    $line .= "|";                $line .= $adressen[$i][$j];            }            $line = addjsslashes($line);            fputs($fp, "$line\n");        }        fclose($fp);    }    function indexof_adres($adressen, $naam)    {        for ($i = 0; $i < sizeof($adressen); $i++)            if ($adressen[$i][0] == $naam)                break;        return $i;    }    $n = 0;    $adressen = array();    /* Lees de entries uit de file. */    $fp = fopen("adressen", "r");    while (!feof($fp)) {        $line = fgets($fp, 1024);        if ($line) {            $line = chop_newline($line);            $line = stripcslashes($line);                        $adres = array();                        $adres = split("\|", $line);            $adressen[$n] = $adres;            $n++;        }    }    fclose($fp);        $actie = $HTTP_POST_VARS["actie"];    $naam = urldecode($HTTP_POST_VARS["naam"]);    if (!$naam)        $naam = urldecode($HTTP_GET_VARS["naam"]);    $bezoekadres = stripcslashes($HTTP_POST_VARS["bezoekadres"]);    $postadres = stripcslashes($HTTP_POST_VARS["postadres"]);    $telefoon = stripcslashes($HTTP_POST_VARS["telefoon"]);        $type = stripcslashes($HTTP_POST_VARS["type"]);    $actief = stripcslashes($HTTP_POST_VARS["actief"]);    $pakket = stripcslashes($HTTP_POST_VARS["pakket"]);    $gespeeld = stripcslashes($HTTP_POST_VARS["gespeeld"]);    $pakketdatum = stripcslashes($HTTP_POST_VARS["pakketdatum"]);    $gespeelddatum = stripcslashes($HTTP_POST_VARS["gespeelddatum"]);    $email = stripcslashes($HTTP_POST_VARS["email"]);    $internet = stripcslashes($HTTP_POST_VARS["internet"]);    $contactpersoon = stripcslashes($HTTP_POST_VARS["contactpersoon"]);    if ($actie == "toevoegen" || $actie == "wijzigen" || $actie == "verwijderen") {        if (!$naam)            $actie = "";        else {            if ($actie == "toevoegen") {                $i = sizeof($adressen);                $adressen[$i][0] = "$naam";                $adressen[$i][1] = "$bezoekadres";                $adressen[$i][2] = "$postadres";                $adressen[$i][3] = "$telefoon";                $adressen[$i][4] = "$type";                $adressen[$i][5] = "$actief";                $adressen[$i][6] = "$pakket";                $adressen[$i][7] = "$gespeeld";                $adressen[$i][8] = "$pakketdatum";                $adressen[$i][9] = "$gespeelddatum";                $adressen[$i][10] = "$email";                $adressen[$i][11] = "$internet";                $adressen[$i][12] = "$contactpersoon";                schrijfadressen($adressen);            }            elseif ($actie == "wijzigen") {                for ($i = 0; $i < sizeof($adressen); $i++)                    if ($adressen[$i][0] == $naam)                        break;                if ($i == sizeof($adressen))                    $key = false;                else                    $key = $i;                                if (!($key === false)) {                    $adressen[$key][0] = "$naam";                    $adressen[$key][1] = "$bezoekadres";                    $adressen[$key][2] = "$postadres";                    $adressen[$key][3] = "$telefoon";                    $adressen[$key][4] = "$type";                    $adressen[$key][5] = "$actief";                    $adressen[$key][6] = "$pakket";                    $adressen[$key][7] = "$gespeeld";                    $adressen[$key][8] = "$pakketdatum";                    $adressen[$key][9] = "$gespeelddatum";                    $adressen[$key][10] = "$email";                    $adressen[$key][11] = "$internet";                    $adressen[$key][12] = "$contactpersoon";                    schrijfadressen($adressen);                }            }            elseif ($actie == "verwijderen") {                for ($i = 0; $i < sizeof($adressen); $i++)                    if ($adressen[$i][0] == $naam)                        break;                if ($i == sizeof($adressen))                    $key = false;                else                    $key = $i;                                if (!($key === false)) {                    $adressen[$key] = $adressen[sizeof($adressen) - 1];                    $adressen = array_slice($adressen, 0, sizeof($adressen) - 1);                    schrijfadressen($adressen);                }            }        }    }    $post_adres = stripcslashes($HTTP_POST_VARS["post_adres"]);    $post_naam = $gebruikersnaam;     $post_commentaar = stripcslashes($HTTP_POST_VARS["post_commentaar"]);    if ($post_adres && $post_naam && $post_commentaar) {        for ($i = 0; $i < sizeof($adressen); $i++)            if ($adressen[$i][0] == $post_adres)                break;        if ($i == sizeof($adressen))            $key = false;        else            $key = $i;                        if (!($key === false)) {            $i = sizeof($adressen[$key]);            $adressen[$key][$i] = $post_naam;            $adressen[$key][$i+1] = date('d/m/Y');            $adressen[$key][$i+2] = date('H.i');            $adressen[$key][$i+3] = $post_commentaar;            schrijfadressen($adressen);        }    }    usort($adressen, adressen_cmp);?><script language="javascript">    function vuladresform(n)    {        switch (n) {        <? for ($i = 0; $i < sizeof($adressen); $i++) { ?>            case <? echo $i ?>:                document.frmadres.naam.value = '<? echo addjsslashes($adressen[$i][0]) ?>';                document.frmadres.bezoekadres.value = '<? echo addjsslashes($adressen[$i][1]) ?>';                document.frmadres.telefoon.value = '<? echo addjsslashes($adressen[$i][3]) ?>';                document.frmadres.email.value = '<? echo addjsslashes($adressen[$i][10]) ?>';                break;        <? } ?>        }    }        function toevoegen()    {        document.frmadres.actie.value = "toevoegen";        document.frmadres.submit();    }        function wijzigen()    {        document.frmadres.actie.value = "wijzigen";        document.frmadres.submit();    }    function verwijderen()    {        document.frmadres.actie.value = "verwijderen";        document.frmadres.submit();    }</script><br><table width="540" cellspacing="2" cellpadding="2" border="0"><?	$j = 0;    while ($j < sizeof($adressen)) {         echo "<tr>";        for ($i = 0; $i < 3; $i++) {			if ($adressen[$j][10] != "") {            echo "<td bgcolor=\"eeeeee\"><a href=\"adressen.php?naam=".urlencode($adressen[$j][0])."\">".$adressen[$j][0]."</a> ( ";			echo "<a href=\"onemail.php?CMD=compose&to=".$adressen[$j][10]."\">mail</a> )</td>";			} else if ($adressen[$j][1] != "") {			            echo "<td><a href=\"adressen.php?naam=".urlencode($adressen[$j][0])."\">".$adressen[$j][0]."</a></td>";			} else { 			echo "<td></td>";			}            $j++;        }        echo "</tr>";    } ?></table><form name="frmadres" action="adressen.php" method="post"><table border="0" cellspacing="10" cellpadding="2">  <tr><td>name:<br>  <textarea name="naam" class="formArea" rows="2"></textarea>  </td><td>email:<br>  <textarea name="email" class="formArea" rows="2"></textarea>  </td></tr><tr><td>place:<br>  <textarea name="bezoekadres" class="formArea" rows="3"></textarea></td><td>  telephone:<br>  <textarea name="telefoon" class="formArea" rows="3"></textarea></td></tr>  <tr><td colspan="2" align="center">  <input type="hidden" name="internet">  <input type="hidden" name="type">  <input type="hidden" name="postadres">  <input type="hidden" name="actief">  <input type="hidden" name="pakket">  <input type="hidden" name="pakketdatum">  <input type="hidden" name="gespeeld">  <input type="hidden" name="gespeelddatum">  <input type="hidden" name="contactpersoon">  <input type="hidden" name="actie">   <?  if ($naam) {          echo "<script language=\"javascript\">";          echo " vuladresform(".indexof_adres($adressen, $naam).");";          echo "</script>";      } ?> <a href="adressen.php">clear</a> | <a href="javascript:toevoegen()">add</a> | <a href="javascript:wijzigen()">change</a> | <a href="javascript:verwijderen()">remove</a> </td></tr></table></form></td></tr></table></body></html>